---
title: "Introduction to ssmRG R-package"
date: "`r Sys.Date()`"
output: 
  rmarkdown::html_vignette:
    fig_caption: yes
vignette: >
  %\VignetteIndexEntry{Introduction to ssmRG R-package}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, echo = FALSE, message = FALSE}
knitr::opts_chunk$set(collapse = T)
library(ssmRG)
```

This vignette introduces you to ssmRG functions and shows you how to apply them to estimate size at sexual maturity based on relative growth (allometric relationship).


## Load data
```{r echo=TRUE}
data(crabdata)

head(crabdata)

names(crabdata)
```


## Classify data and plot
The `classify_data` function classify the individuals in two groups (juvelines = 0 and adult = 1). The classification analisys is based on Principal Components Analisys with two variables (x: independent variable, y: dependent variable) in log base, allowing to distinguish two groups that would represent juveniles and adult. The individuals are assigned to each group using a hierarchical classification procedure (hierarchical cluster). This method is based on establishing a predetermined number of groups (in this case, two) and assigning individuals to one of the groups according to their loads on the two axes of the PCA.

Using the results of the classification (PCA + cluster), a discriminant analysis (linear or quadratic) is conducted to obtain a discriminating function that permitted any individuals to be classified as a juvenile or an adult on the basis of the X and Y variables.

The function requires a data.frame (e.g. crabdata) with alometric variables and sex category. The argument `varnames` requires two allometric variables only, and `varsex` requires the sex variable name. If the `selecSex` is `NULL` all the individuals will be used in the classification analysis. Finally the `method` is focus in the discriminant analysis to be used ("ld": linear discriminant analysis, "qd": quadratic discriminant analysis), if `method` is `NULL` ld or qd will be used in the discrimination analysis based on the test of homogeneity of covariance matrices.

The function return an object of class "classify", with the allometric variables "x" (independent) and "y"" (dependent), and mature classification (juveniles = 0, adult = 1) variables.

```{r, echo=TRUE}
#For all the individuals
classify_data = classify_mature(crabdata, varnames = c("carapace_width", "chela_heigth"), 
varsex = "sex_category", selectSex = NULL, method = "ld")

#For males only
classify_data_males = classify_mature(crabdata, varnames = c("carapace_width", "chela_heigth"), 
varsex = "sex_category", selectSex = "m", method = "ld")

```


```{r, echo=TRUE, fig.width = 10, fig.height = 10, results='hide', warning=FALSE}
par(mfrow = c(2,2))
plot(classify_data)

plot(classify_data, xlab = "Carapace width (mm.)", ylab = "Chela heigth (mm)")

plot(classify_data, xlab = "Carapace width (mm.)", ylab = "Chela heigth (mm)", 
     col = c(2, 3), pch = c(5, 6))

plot(classify_data, xlab = "Carapace width (mm.)", ylab = "Chela heigth (mm)", 
     col = c(2, 3), pch = c(5, 6), lty_lines = c(1, 2), lwd_lines = c(1, 3), main = "Classification")
```


## Estimate size at sexual maturity
The `calculate_ogive` function use a logistic regression to estimate parametres using the equation:

$$Y =  1/1+exp-(A + B*X) $$  

The function requires an object of class "classify" with the X, Y (allometric variables) and mature classification (juvelines = 0, adults = 1).

The argument `method` requires 

```{r echo=TRUE}
my_ogive = calculate_ogive(classify_data, method = "fq", niter = 1000)

```

